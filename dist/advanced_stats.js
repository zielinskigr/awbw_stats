(()=>{"use strict";async function t(t){return await new Promise((e=>setTimeout(e,t)))}const e={1:{primary:"#F46243",secondary:"#F89F8B",tertiary:"#D4310C"},2:{primary:"#446EFF",secondary:"#99AFFF",tertiary:"#001F8F"},3:{primary:"#12D815",secondary:"#8EF690",tertiary:"#064B07"},4:{primary:"#FBD412",secondary:"#FDE986",tertiary:"#B59703"},5:{primary:"#8A3E96",secondary:"#C78BD0",tertiary:"#5D2965"},6:{primary:"#C4443D",secondary:"#CF6863",tertiary:"#9C3530"},7:{primary:"#999B98",secondary:"#C2C2C1",tertiary:"#525251"},8:{primary:"#C58950",secondary:"#DBB694",tertiary:"#8A5A2E"},9:{primary:"#FCA339",secondary:"#FDC886",tertiary:"#DD7B03"},10:{primary:"#CBDDBA",secondary:"#A2C284",tertiary:"#6F964A"},16:{primary:"#1B43BD",secondary:"#3B65E3",tertiary:"#122D7D"},17:{primary:"#FE68CF",secondary:"#FE9ADF",tertiary:"#FD0DB1"},19:{primary:"#3ACFC1",secondary:"#7CDFD5",tertiary:"#208379"},20:{primary:"#CE64FE",secondary:"#DF9AFE",tertiary:"#A602F2"},21:{primary:"#5F7C0C",secondary:"#8DBA12",tertiary:"#B3E920"},22:{primary:"#BB534F",secondary:"#C66F6C",tertiary:"#E2B7B6"}};async function a(t,e=0){return(await fetch("https://awbw.amarriner.com/api/game/load_replay.php",{method:"POST",body:JSON.stringify({gameId:t,turn:e,initial:!0})})).json()}const r=t=>{t.attributes=t.attributes||[],t.classes=t.classes||[],t.children=t.children||[];const e=document.createElement(t.tag);return e.classList.add(...t.classes),t.attributes.forEach((([t,a])=>{e.setAttribute(t,a)})),e.innerText="",t.children.forEach((t=>{"string"==typeof t?e.innerText+=t:e.appendChild(t)})),e};async function n(){const n=document.getElementById("gamecontainer"),i=function(){let t=[],e=[];Object.keys(o).forEach((a=>{let n=r({tag:"div",attributes:[["id",o[a].button.id]],children:[o[a].button.children]});n.onclick=()=>{console.log("CLICK"),Object.keys(o).forEach((t=>{console.log("Cid",a),console.log("sid",t),document.getElementById(o[t].button.chartName).setAttribute("style","display: none;")})),console.log("Cid2",a),document.getElementById(o[a].button.chartName).setAttribute("style","display: block;")};let i=r({tag:"canvas",attributes:[["style","display: none;"],["id",o[a].button.chartName]]});t.push(n),e.push(i)}));const a=r({tag:"div",attributes:[["style","position:absolute;right: -10px;background: #ddd;padding: 5px;top: -6px;"],["id","closebutton"]],children:["X"]});a.onclick=()=>{c.remove()};const n=r({tag:"div",attributes:[["id","chartsmenu"],["style","position:relative;display: flex;flex-flow: row;justify-content: space-around;margin-top: -25px;margin-bottom: 10px;cursor: pointer;"]],children:[...t,a]}),i=r({tag:"div",attributes:[["id","chartloader"]],children:["Fetching game data, this can take up to a minute depending on game length, please wait..."]}),c=r({tag:"div",attributes:[["id","chartscontainer"],["style","position: relative; margin-top:20px;top: 33%;max-width: 1000px;width: 100%;height: 500px;padding: 40px 20px 20px;background: #fff;overflow: hidden;display: flex;flex-flow: column;"]],children:[n,i,...e]});return c}();let c;n.appendChild(i);try{c=await async function(){const e=new URLSearchParams(window.location.search).get("games_id"),r=await async function(e){const r=await a(e),n=r.daySelector.length;let o,i={};if(2!==r.players.length)throw new Error("Can only work on 2 players, sorry.");r.players.forEach((async t=>{i[t.id]={player:t,turnsArray:[]}}));let c=0;for(;c<n;)await t(250),o=await a(e,c),i[o.gameState.currentTurnPId].turnsArray.push(o),c++;return i}(e);let n={};return Object.keys(r).forEach((t=>{let e=0;n[t]={name:r[t].turnsArray[0].gameState.players[t].users_username,turns:r[t].turnsArray.length,country:r[t].player.countries_id,funds:[],income:[],unitCount:[],unitValue:[],unitHP:[],unitHPCount:[]},r[t].turnsArray.forEach((a=>{e+=a.gameState.players[t].players_funds;let r=0;Object.values(a.gameState.units).forEach((e=>{e.units_players_id==t&&(r+=e.units_hit_points)}));let o=r/a.gameState.players_units_count[t].total;n[t].funds.push(e),n[t].income.push(a.gameState.players[t].players_income),n[t].unitCount.push(a.gameState.players_units_count[t].total),n[t].unitValue.push(a.gameState.players_units_count[t].value),n[t].unitHP.push(r),n[t].unitHPCount.push(o)}))})),n}()}catch(t){i.remove(),console.log(t)}if(!c)throw i.remove(),new Error("Failed to load game data.");document.getElementById("chartloader").remove(),Object.keys(c);const s=Math.max(...(t=>{let e=[];return Object.values(t).forEach((t=>{e.push(t.turns)})),e})(c));!function(t,a){let r=function(t){let a=[],r=[],n=[],o=[],i=[],c=[];return Object.values(t).forEach((t=>{let s={label:t.name+" Funds",backgroundColor:e[t.country].primary,borderColor:e[t.country].primary,data:t.funds};a.push(s);let u={label:t.name+" Income",backgroundColor:e[t.country].primary,borderColor:e[t.country].primary,data:t.income};r.push(u);let l={label:t.name+" Unit Count",backgroundColor:e[t.country].primary,borderColor:e[t.country].primary,data:t.unitCount};n.push(l);let d={label:t.name+" Unit Value",backgroundColor:e[t.country].primary,borderColor:e[t.country].primary,data:t.unitValue};o.push(d);let y={label:t.name+" Unit HP",backgroundColor:e[t.country].primary,borderColor:e[t.country].primary,data:t.unitHP};i.push(y);let m={label:t.name+" Unit HP/Count",backgroundColor:e[t.country].primary,borderColor:e[t.country].primary,data:t.unitHPCount};c.push(m)})),{fundsDataSet:a,incomeDataSet:r,ucDataSet:n,uvDataSet:o,hpDataSet:i,hpcDataSet:c}}(t);console.log("datasets",r);const n={type:"line",data:{labels:a,datasets:r.fundsDataSet},options:{}},o=(new Chart(document.getElementById("fundschart"),n),{type:"line",data:{labels:a,datasets:r.incomeDataSet},options:{}}),i=(new Chart(document.getElementById("incomechart"),o),{type:"line",data:{labels:a,datasets:r.ucDataSet},options:{}}),c=(new Chart(document.getElementById("ucchart"),i),{type:"line",data:{labels:a,datasets:r.uvDataSet},options:{}}),s=(new Chart(document.getElementById("uvchart"),c),{type:"line",data:{labels:a,datasets:r.hpDataSet},options:{}}),u=(new Chart(document.getElementById("hpchart"),s),{type:"line",data:{labels:a,datasets:r.hpcDataSet},options:{}});new Chart(document.getElementById("hpcchart"),u),document.getElementById("fundschart").setAttribute("style","display: block;")}(c,Array.from(Array(s).keys()))}const o={fundschart:{button:{id:"fundsbutton",children:"Total Funds",chartName:"fundschart"}},incomechart:{button:{id:"incomebutton",children:"Income",chartName:"incomechart"}},ucchart:{button:{id:"ucbutton",children:"Unit Count",chartName:"ucchart"}},uvchart:{button:{id:"uvbutton",children:"Army Value",chartName:"uvchart"}},hpchart:{button:{id:"hpbutton",children:"Unit HP",chartName:"hpchart"}},hpcchart:{button:{id:"hpcbutton",children:"Unit HP/Count",chartName:"hpcchart"}}};var i;i=function(){const t=r({tag:"div",classes:["game-tools-bg"],children:["Stats"]}),e=r({tag:"div",classes:["game-tools-btn","enchanced-stats"],children:[t]});e.onclick=()=>{n()};const a=r({tag:"section",children:[e]});document.getElementById("game-menu-controls").prepend(a)}(),"complete"===document.readyState||"interactive"===document.readyState?setTimeout(i,1):document.addEventListener("DOMContentLoaded",i)})();