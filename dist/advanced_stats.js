(()=>{"use strict";async function t(t){return await new Promise((e=>setTimeout(e,t)))}const e={1:"rgb(244,98,67)",2:"rgb(68,110,255)",3:"rgb(18,216,21)",4:"rgb(251,212,18)",5:"rgb(138,62,150)",6:"rgb(196,68,61)",7:"rgb(153,155,152)",8:"rgb(197,137,80)",9:"rgb(252,163,57)",10:"rgb(203,221,186)",16:"rgb(27,67,189)",17:"rgb(254,104,207)",19:"rgb(58,207,193)",20:"rgb(206,100,254)",21:"rgb(95,124,12)",22:"rgb(187,83,79)"};async function n(t,e=0){return(await fetch("https://awbw.amarriner.com/api/game/load_replay.php",{method:"POST",body:JSON.stringify({gameId:t,turn:e,initial:!0})})).json()}const a=t=>{t.attributes=t.attributes||[],t.classes=t.classes||[],t.children=t.children||[];const e=document.createElement(t.tag);return e.classList.add(...t.classes),t.attributes.forEach((([t,n])=>{e.setAttribute(t,n)})),e.innerText="",t.children.forEach((t=>{"string"==typeof t?e.innerText+=t:e.appendChild(t)})),e};async function r(){const r=document.getElementById("gamecontainer"),s=function(){const t=a({tag:"div",attributes:[["id","fundsbutton"]],children:["Total Funds"]}),e=a({tag:"div",attributes:[["id","incomebutton"]],children:["Income"]}),n=a({tag:"div",attributes:[["id","ucbutton"]],children:["Unit Count"]}),r=a({tag:"div",attributes:[["id","uvbutton"]],children:["Army Value"]}),s=a({tag:"div",attributes:[["style","position:absolute;right: -10px;background: #ddd;padding: 5px;top: -6px;"],["id","closebutton"]],children:["X"]});s.onclick=()=>{y.remove()};const o=a({tag:"canvas",attributes:[["style","display: none;"],["id","fundschart"]]}),i=a({tag:"canvas",attributes:[["style","display: none;"],["id","incomechart"]]}),l=a({tag:"canvas",attributes:[["style","display: none;"],["id","ucchart"]]}),c=a({tag:"canvas",attributes:[["style","display: none;"],["id","uvchart"]]});t.onclick=()=>{o.setAttribute("style","display: block;"),i.setAttribute("style","display: none;"),l.setAttribute("style","display: none;"),c.setAttribute("style","display: none;")},e.onclick=()=>{o.setAttribute("style","display: none;"),i.setAttribute("style","display: block;"),l.setAttribute("style","display: none;"),c.setAttribute("style","display: none;")},n.onclick=()=>{o.setAttribute("style","display: none;"),i.setAttribute("style","display: none;"),l.setAttribute("style","display: block;"),c.setAttribute("style","display: none;")},r.onclick=()=>{o.setAttribute("style","display: none;"),i.setAttribute("style","display: none;"),l.setAttribute("style","display: none;"),c.setAttribute("style","display: block;")};const u=a({tag:"div",attributes:[["id","chartsmenu"],["style","position:relative;display: flex;flex-flow: row;justify-content: space-around;margin-top: -25px;margin-bottom: 10px;cursor: pointer;"]],children:[t,e,n,r,s]}),d=a({tag:"div",attributes:[["id","chartloader"]],children:["Fetching game data, this can take up to a minute depending on game length, please wait..."]}),y=a({tag:"div",attributes:[["id","chartscontainer"],["style","position: relative; margin-top:20px;top: 33%;width: 600px;height: 320px;padding: 40px 20px 20px;background: #fff;overflow: hidden;display: flex;flex-flow: column;"]],children:[u,d,o,i,l,c]});return y}();let o;r.appendChild(s);try{o=await async function(){const e=new URLSearchParams(window.location.search).get("games_id");console.log(e);const a=await async function(e){const a=await n(e),r=a.daySelector.length;let s,o={};if(2!==a.players.length)throw new Error("Can only work on 2 players, sorry.");a.players.forEach((async t=>{o[t.id]={player:t,turnsArray:[]}}));let i=0;for(;i<r;)await t(250),s=await n(e,i),o[s.gameState.currentTurnPId].turnsArray.push(s),i++;return o}(e);console.log(a);let r={};return Object.keys(a).forEach((t=>{let e=0;r[t]={name:a[t].turnsArray[0].gameState.players[t].users_username,turns:a[t].turnsArray.length,country:a[t].player.countries_id,funds:[],income:[],unitCount:[],unitValue:[]},a[t].turnsArray.forEach((n=>{e+=n.gameState.players[t].players_funds,r[t].funds.push(e),r[t].income.push(n.gameState.players[t].players_income),r[t].unitCount.push(n.gameState.players_units_count[t].total),r[t].unitValue.push(n.gameState.players_units_count[t].value)}))})),r}()}catch(t){s.remove(),console.log(t)}if(!o)throw s.remove(),new Error("Failed to load game data.");document.getElementById("chartloader").remove(),Object.keys(o);const i=Math.max(...(t=>{let e=[];return Object.values(t).forEach((t=>{e.push(t.turns)})),e})(o)),l=Array.from(Array(i).keys());let c=[];Object.values(o).forEach((t=>{let n={label:t.name+" Funds",backgroundColor:e[t.country],borderColor:e[t.country],data:t.funds};c.push(n)}));const u={type:"line",data:{labels:l,datasets:c},options:{}};new Chart(document.getElementById("fundschart"),u),c=[],Object.values(o).forEach((t=>{let n={label:t.name+" Income",backgroundColor:e[t.country],borderColor:e[t.country],data:t.income};c.push(n)}));const d={type:"line",data:{labels:l,datasets:c},options:{}};new Chart(document.getElementById("incomechart"),d),c=[],Object.values(o).forEach((t=>{let n={label:t.name+" Unit Count",backgroundColor:e[t.country],borderColor:e[t.country],data:t.unitCount};c.push(n)}));const y={type:"line",data:{labels:l,datasets:c},options:{}};new Chart(document.getElementById("ucchart"),y),c=[],Object.values(o).forEach((t=>{let n={label:t.name+" Unit Value",backgroundColor:e[t.country],borderColor:e[t.country],data:t.unitValue};c.push(n)}));const p={type:"line",data:{labels:l,datasets:c},options:{}};new Chart(document.getElementById("uvchart"),p),document.getElementById("fundschart").setAttribute("style","display: block;")}var s;s=function(){const t=a({tag:"div",classes:["game-tools-bg"],children:["Stats"]}),e=a({tag:"div",classes:["game-tools-btn","enchanced-stats"],children:[t]});e.onclick=()=>{r()};const n=a({tag:"section",children:[e]});document.getElementById("game-menu-controls").prepend(n)}(),"complete"===document.readyState||"interactive"===document.readyState?setTimeout(s,1):document.addEventListener("DOMContentLoaded",s)})();